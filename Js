document.addEventListener("DOMContentLoaded", function() {
    // DOM элементы
    const welcomeScreen = document.getElementById("welcomeScreen");
    const gameScreen = document.getElementById("gameScreen");
    const resultsScreen = document.getElementById("resultsScreen");

    const playerNameInput = document.getElementById("playerNameInput");
    const playerNameDisplay = document.getElementById("playerNameDisplay");
    const startGameBtn = document.getElementById("startGameBtn");
    const exitGameBtn = document.getElementById("exitGame");
    const backToWelcomeBtn = document.getElementById("backToWelcome");

    const timerDisplay = document.getElementById("timerDisplay");
    const scoreDisplay = document.getElementById("scoreDisplay");
    const clickCircle = document.getElementById("clickCircle");

    const leaderboardBody = document.getElementById("leaderboardBody");

    // Переменные игры
    let playerName = "";
    let score = 0;
    let time = 0;
    let timerInterval;
    const gameDuration = 30; // Длительность игры в секундах
    let leaderboard = JSON.parse(localStorage.getItem("leaderboard")) || []; // Загрузка таблицы рекордов из localStorage

    // Обработчики событий
    startGameBtn.addEventListener("click", function() {
        playerName = playerNameInput.value.trim();
        if (playerName) {
            welcomeScreen.classList.remove("active");
            gameScreen.classList.add("active");
            playerNameDisplay.textContent = `Игрок: ${playerName}`;
            startGame();
        } else {
            alert("Введите ваше имя!");
        }
    });

    exitGameBtn.addEventListener("click", function() {
        endGame();
    });

    backToWelcomeBtn.addEventListener("click", function() {
        resultsScreen.classList.remove("active");
        welcomeScreen.classList.add("active");
    });

    // Логика игры
    function startGame() {
        score = 0;
        time = 0;
        scoreDisplay.textContent = "Счет: 0";
        timerDisplay.textContent = "00:00";
        clickCircle.addEventListener("click", handleClick);
        timerInterval = setInterval(updateTimer, 1000);
    }

    function handleClick() {
        score++;
        scoreDisplay.textContent = `Счет: ${score}`;
    }

    function updateTimer() {
        time++;
        const minutes = Math.floor(time / 60).toString().padStart(2, '0');
        const seconds = (time % 60).toString().padStart(2, '0');
        timerDisplay.textContent = `${minutes}:${seconds}`;

        if (time >= gameDuration) {
            endGame();
        }
    }

    function endGame() {
        clearInterval(timerInterval);
        clickCircle.removeEventListener("click", handleClick);
        gameScreen.classList.remove("active");
        resultsScreen.classList.add("active");
        updateLeaderboard();
    }

    // Обновление таблицы рекордов
    function updateLeaderboard() {
        leaderboard.push({ name: playerName, score: score });
        leaderboard.sort((a, b) => b.score - a.score);
        leaderboard = leaderboard.slice(0, 5); // Оставляем только 5 лучших результатов
        localStorage.setItem("leaderboard", JSON.stringify(leaderboard));

        leaderboardBody.innerHTML = "";
        leaderboard.forEach((entry, index) => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${index + 1}</td>
                <td>${entry.name}</td>
                <td>${entry.score}</td>
            `;
            leaderboardBody.appendChild(row);
        });
    }

    // Инициализация таблицы рекордов при загрузке страницы
    updateLeaderboard();
});
